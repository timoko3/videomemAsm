Turbo Assembler	 Version 4.1	    02/09/26 26:46:38	    Page 1
vidframe.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     .286
      4				     org 100h
      5
      6	0100  B8 B800		     Start:  mov ax, 0B800h  ; initializing video memory segment register
      7	0103  8E C0			     mov es, ax
      8
      9	0105  33 DB			     xor bx, bx
     10	0107  BB 0370			     mov bx, 160 * 5 + 80  ; init video	segment	shift
     11
     12	010A  B6 24			     mov dh, 24h ; $ ASCII const
     13
     14					     ; read mode from cmd and put in dl	symbol for frame
     15
     16	010C  E8 001C			     call getMode
     17
     18	010F  BE 01B2r			     mov si, offset String     ; string	to print addr -> si
     19
     20	0112  E8 008E			     call strlen   ; count string length procedure
     21
     22	0115  E8 0035			     call printFrame
     23
     24	0118  81 C3 00A0		     add bx, 160     ; move to next line
     25
     26	011C  E8 0050			     call printText
     27
     28	011F  81 C3 00A0		     add bx, 160     ; move to next line
     29
     30	0123  E8 0027			     call printFrame
     31
     32					     ; end programm interrupt
     33	0126  B8 4C00			     mov ax, 4C00h
     34	0129  CD 21			     int 21h
     35
     36	012B			     getMode PROC
     37	012B  BE 0080			     mov si, 80h   ; write in si cmd len addr
     38
     39	012E  8A 14			     mov dl, [si]  ; write in dl temporary cmd length
     40
     41	0130  80 FA 00			     cmp dl, 0
     42	0133  75 03			     jne skipNoMode   ;	handle the no mode case
     43	0135					     wrongMode:	  ; jump here if number	don't match appropriate
     44	0135  B2 04				     mov dl, 04h
     45	0137  C3				     ret
     46	0138				     skipNoMode:
     47
     48					     ; get mode	number
     49
     50	0138  BE 0082			     mov si, 82h
     51	013B  8A 14			     mov dl, [si]
     52
     53					     ; handle mode number
     54
     55	013D  80 FA 31			     cmp dl, 1 + '0'
     56	0140  75 03			     jne notFirstMode
     57	0142  B2 03				     mov dl, 03h
Turbo Assembler	 Version 4.1	    02/09/26 26:46:38	    Page 2
vidframe.asm



     58
     59	0144  C3				     ret
     60	0145				     notFirstMode:
     61
     62	0145  80 FA 32			     cmp dl, 2 + '0'
     63	0148  75 EB			     jne wrongMode
     64	014A  B2 05				     mov dl, 05h
     65
     66	014C  C3				     ret
     67
     68	014D			     getMode ENDP
     69
     70	014D			     printFrame	PROC
     71	014D  8B C1			     mov ax, cx
     72	014F  05 0002			     add ax, 2
     73
     74	0152  BF 0001			     mov di, 1
     75	0155				     frameCycleStart:
     76
     77	0155  26: 88 17			     mov byte ptr es:[bx], dl
     78	0158  26: C6 47	01 03		     mov byte ptr es:[bx + 1], 03h
     79
     80	015D  3B F8			     cmp di, ax
     81	015F  74 06			     je	endFrameCycle
     82
     83	0161  47			     inc di
     84	0162  83 C3 02			     add bx, 2
     85
     86	0165  EB EE			     jmp frameCycleStart
     87
     88	0167				     endFrameCycle:
     89
     90					     ; return bx start value
     91	0167  2D 0001			     sub ax, 1
     92	016A  03 C0			     add ax, ax
     93	016C  2B D8			     sub bx, ax
     94
     95	016E  C3			     ret
     96	016F			     printFrame	ENDP
     97
     98	016F			     printText PROC
     99					     ; part of frame
    100	016F  26: 88 17			     mov byte ptr es:[bx], dl
    101	0172  26: C6 47	01 03		     mov byte ptr es:[bx+1], 03h
    102	0177  83 C3 02			     add bx, 2
    103
    104					     ; text to videomem
    105	017A				     cycleStart:
    106	017A  8A 24			     mov ah, [si]
    107
    108	017C  3A E6			     cmp ah, dh
    109	017E  74 0E			     je	endStr
    110	0180  26: 88 27			     mov byte ptr es:[bx], ah
    111	0183  26: C6 47	01 15		     mov byte ptr es:[bx+1], 15h
    112
    113	0188  46			     inc si
    114	0189  83 C3 02			     add bx, 2
Turbo Assembler	 Version 4.1	    02/09/26 26:46:38	    Page 3
vidframe.asm



    115
    116	018C  EB EC			     jmp cycleStart
    117
    118	018E				     endStr:
    119
    120					     ; part of frame
    121	018E  26: 88 17			     mov byte ptr es:[bx], dl
    122	0191  26: C6 47	01 03		     mov byte ptr es:[bx+1], 03h
    123	0196  83 C3 02			     add bx, 2
    124
    125					     ; return bx start value
    126	0199  8B C1			     mov ax, cx
    127	019B  05 0002			     add ax, 2
    128	019E  03 C0			     add ax, ax
    129	01A0  2B D8			     sub bx, ax
    130
    131	01A2  C3			     ret
    132	01A3			     printText ENDP
    133
    134	01A3			     strlen PROC
    135	01A3  8B FE			     mov di, si
    136	01A5  33 C9			     xor cx, cx
    137
    138
    139	01A7				     strlenCycle:
    140	01A7  8A 25			     mov ah, [di]
    141
    142	01A9  3A E6			     cmp ah, dh
    143	01AB  74 04			     je	strlenEnd
    144	01AD  47			     inc di
    145
    146	01AE  41			     inc cx    ; increment symbols counter
    147	01AF  EB F6			     jmp strlenCycle
    148	01B1				     strlenEnd:
    149	01B1  C3			     ret
    150	01B2			     strlen ENDP
    151
    152	01B2  48 65 6C 6C 6F 24	     String  db	'Hello$'
    153
    154				     end Start
Turbo Assembler	 Version 4.1	    02/09/26 26:46:38	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/09/26"
??FILENAME			  Text	 "vidframe"
??TIME				  Text	 "26:46:38"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0707H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 VIDFRAME
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
CYCLESTART			  Near	 DGROUP:017A
ENDFRAMECYCLE			  Near	 DGROUP:0167
ENDSTR				  Near	 DGROUP:018E
FRAMECYCLESTART			  Near	 DGROUP:0155
GETMODE				  Near	 DGROUP:012B
NOTFIRSTMODE			  Near	 DGROUP:0145
PRINTFRAME			  Near	 DGROUP:014D
PRINTTEXT			  Near	 DGROUP:016F
SKIPNOMODE			  Near	 DGROUP:0138
START				  Near	 DGROUP:0100
STRING				  Byte	 DGROUP:01B2
STRLEN				  Near	 DGROUP:01A3
STRLENCYCLE			  Near	 DGROUP:01A7
STRLENEND			  Near	 DGROUP:01B1
WRONGMODE			  Near	 DGROUP:0135

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  01B8 Word	  Public  CODE
